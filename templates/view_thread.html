{% extends "base.html" %}

{% block content %}

<h2>{{ thread.title }}</h2>
<p class="text-white">by {{ thread.creator.username }} on {{ thread.date }}</p>
<p>{{ thread.description or "No description." }}</p>

<a class="btn btn-outline-light mb-4" href="/thread/{{ thread.threadID }}/create_post">Add a Post</a>

<hr>

{% if thread.posts %}
{% for post in thread.posts %}
<div class="mb-4 p-3 border rounded bg-dark text-light">
    <p class="fw-bold fs-5"><a href="{{ url_for('view_post', thread_id=post.threadID, post_id=post.postID) }}"
                               class="text-decoration-none text-light fw-bold">
        {{ post.title }}
    </a>
    </p>
    <p>{{ post.text }}</p>

    {% if post.img %}
    <img src="{{ url_for('static', filename=post.img) }}" class="img-fluid rounded mb-3" style="max-height: 300px;"
         alt="Post image">
    {% endif %}

    <small>by {{ post.creator.username }} on {{ post.date }}</small>
    <br>


    <form method="POST" action="/nod">
        <input type="hidden" name="post_id" value="{{ post.postID }}">
        <button type="submit" class="btn btn-outline-light p-0 border-0" style="width: 40px; height: 40px;">
            <img src="/static/emojinodit.png" alt="Nodding Emoji" class="w-100 h-100" style="object-fit: contain;">
        </button>

    </form>

    <p class="text-light mt-2">{{ post.nods | length }} Nods</p>


    <ul class="mb-2 ps-0" style="list-style: none;">
        {% if current_user.role == 'Admin' %}
        <li>
            <form method="POST" action="/post/{{ post.postID }}/delete">
                <button class="btn btn-outline-danger btn-sm">Delete Post</button>
            </form>
        </li>
        {% endif %}
        <li>
            <a class="btn btn-sm btn-outline-info mt-2"
               href="/thread/{{ thread.threadID }}/post/{{ post.postID }}/comment">Comment</a>
        </li>
    </ul>

    {% if post.comments %}
    <div class="mt-3 ms-3">
        <strong>Comments:</strong>
        {% for comment in post.comments %}
        <div class="border p-2 mt-2 rounded bg-dark text-white">
            <p>{{ comment.text }}</p>

            {% if comment.img %}
            <img src="{{ url_for('static', filename=comment.img) }}" class="img-fluid rounded mb-2"
                 style="max-height: 200px;" alt="Comment image">
            {% endif %}

            <small>by {{ comment.commenter.username }} on {{ comment.date }}</small>

            <form method="POST" action="/nod">
                <input type="hidden" name="comment_id" value="{{ comment.commentID }}">
                <button type="submit" class="btn btn-outline-light p-0 border-0" style="width: 40px; height: 40px;">
                    <img src="/static/emojinodit.png" alt="Nodding Emoji" class="w-100 h-100"
                         style="object-fit: contain;">
                </button>
            </form>

            <p class="text-light mt-2">{{ comment.nods | length }} Nods</p>


            {% if current_user.role == 'Admin' %}
            <form method="POST" action="/comment/{{ comment.commentID }}/delete" class="mt-2">
                <button class="btn btn-sm btn-outline-danger">Delete Comment</button>
            </form>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endfor %}
{% else %}
<p>No posts yet.</p>
{% endif %}

{% endblock %}


